<%- partial('_partial/head') %>

    <body class="gitbook-page">
        <%- partial('_partial/navigation') %>

            <div class="gitbook-container">
                <!-- 1. Sidebar -->
                <aside class="gitbook-sidebar" id="gitbook-sidebar">
                    <div class="sidebar-resizer" id="sidebar-resizer"></div>
                    <div class="sidebar-header">
                        <div class="sidebar-logo">
                            <a href="/cheatsheets/" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit;">
                                <img src="/cheatsheets/wizard.png" alt="Wizard Logo"
                                    style="height: 48px; width: auto; margin-right: 8px; pointer-events: none;">
                                <span>0zAttacker's Cookbook</span>
                            </a>
                        </div>
                        <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                    </div>

                    <div class="sidebar-search">
                        <input type="text" id="docs-search" placeholder="Search documentation..." />
                        <i class="fa fa-search"></i>
                    </div>

                    <nav class="sidebar-nav" id="sidebar-nav">
                        <div class="loading-spinner">
                            <i class="fa fa-spinner fa-spin"></i>
                            <span>Loading...</span>
                        </div>
                    </nav>

                    <div class="sidebar-footer">
                        <a href="https://github.com/vipa0z/field-notes" target="_blank" rel="noopener">
                            <i class="fa fa-github"></i> View on GitHub
                        </a>
                    </div>
                </aside>

                <!-- 2. Sidebar Open Button (Visible when sidebar collapsed) -->
                <button class="sidebar-open-btn" id="sidebar-open-btn" title="Open Sidebar">
                    <i class="fa fa-bars"></i>
                    <span>Menu</span>
                </button>

                <!-- 3. Markdown Body (Middle Column) -->
                <main class="gitbook-main" id="gitbook-content">
                    <div class="content-header">
                        <div class="breadcrumb" id="breadcrumb">
                            <a href="/cheatsheets/">Home</a>
                        </div>
                        <div style="margin-left: auto;">
                            <button class="theme-toggle-btn"
                                style="background:none; border:none; padding:8px; color:#888;"
                                aria-label="Toggle theme">
                                <i class="fa fa-moon-o"></i>
                            </button>
                        </div>
                    </div>

                    <article class="content-body" id="content-body">
                        <%- page.content %>

                        <% if (page.title === 'Field Notes') { %>
                        <div class="quick-links">
                            <h3>Browse by Category</h3>
                            <div class="quick-links-grid" id="quick-links-grid">
                                <div class="loading-spinner">
                                    <i class="fa fa-spinner fa-spin"></i>
                                </div>
                            </div>
                        </div>
                        <% } %>
                    </article>

                    <%
                    var sheetImages = [];
                    if (typeof list_images_in_dir === 'function') {
                        sheetImages = list_images_in_dir('source/images/#chsheet');
                    }
                    %>
                    <script>
                        (function() {
                            var images = <%- JSON.stringify(sheetImages) %>;
                            if (images.length > 0) {
                                var imgElement = document.querySelector('.welcome-image');
                                if (imgElement) {
                                    var currentIndex = 0;
                                    var dir = '/images/%23chsheet/';
                                    
                                    // Set initial random image
                                    currentIndex = Math.floor(Math.random() * images.length);
                                    imgElement.src = dir + images[currentIndex];

                                    setInterval(function() {
                                        currentIndex = (currentIndex + 1) % images.length;
                                        imgElement.style.opacity = 0;
                                        setTimeout(function() {
                                            imgElement.src = dir + images[currentIndex];
                                            imgElement.onload = function() {
                                                imgElement.style.opacity = 1;
                                            };
                                        }, 500); // Wait for fade out
                                    }, 5000); // Rotate every 5 seconds

                                    // Ensure transition
                                    imgElement.style.transition = 'opacity 0.5s ease-in-out';
                                }
                            }
                        })();
                    </script>

                    <div class="content-footer">
                        <div class="nav-buttons">
                            <button class="nav-btn prev" id="prev-btn" disabled>
                                <i class="fa fa-chevron-left"></i>
                                <span>Previous</span>
                            </button>
                            <button class="nav-btn next" id="next-btn" disabled>
                                <span>Next</span>
                                <i class="fa fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </main>

                <!-- 3. Meta (Right Column -> TOC) -->
                <div class="meta">
                    <aside class="content-toc" id="content-toc">
                        <div class="toc-header">
                            <span>On this page</span>
                        </div>
                        <nav class="toc-nav" id="toc-nav">
                            <!-- TOC will be populated by JavaScript -->
                        </nav>
                    </aside>
                </div>
            </div>

            <!-- Markdown Parser -->
            <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
            <!-- Syntax Highlighting -->
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-powershell.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
            <script src="/js/gitbook.js"></script>

            <%- partial('_partial/after_footer') %>
    </body>

    </html>